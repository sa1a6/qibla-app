<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>تحويل العملات - Currency Converter</title>
  <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
  <style>
    body {
      font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
      background: #f5f5f7;
      margin: 0;
      padding: 20px;
      direction: rtl;
    }
    .container {
      max-width: 600px;
      margin: auto;
      background: #fff;
      border-radius: 8px;
      padding: 20px;
      box-shadow: 0 4px 8px rgb(0 0 0 / 0.1);
    }
    h1, h2 {
      text-align: center;
      margin-bottom: 20px;
      color: #333;
    }
    label {
      display: block;
      margin: 15px 0 5px;
      font-weight: bold;
    }
    select, input[type="number"], button {
      width: 100%;
      padding: 10px;
      border-radius: 5px;
      border: 1px solid #ccc;
      font-size: 16px;
      box-sizing: border-box;
    }
    button {
      background-color: #5a70ff;
      color: white;
      font-weight: bold;
      border: none;
      cursor: pointer;
      margin-top: 20px;
      transition: background-color 0.3s ease;
    }
    button:hover {
      background-color: #3246d6;
    }
    .result {
      margin-top: 30px;
      background: #e0f0ff;
      padding: 20px;
      border-radius: 8px;
      font-size: 1.3rem;
      font-weight: bold;
      text-align: center;
      color: #1a3c72;
      box-shadow: 0 2px 8px rgb(26 60 114 / 0.3);
    }
    .chart-container {
      margin-top: 40px;
    }
    .update-time {
      text-align: center;
      margin-top: 10px;
      font-size: 0.9rem;
      color: #555;
    }
    .language-toggle {
      position: fixed;
      top: 15px;
      left: 15px;
      background: #5a70ff;
      color: white;
      border: none;
      padding: 10px 15px;
      cursor: pointer;
      border-radius: 5px;
      font-weight: bold;
      transition: background-color 0.3s ease;
      z-index: 1000;
    }
    .language-toggle:hover {
      background-color: #3246d6;
    }
  </style>
</head>
<body>

  <button class="language-toggle" id="toggleLang">English</button>

  <div class="container" id="app">
    <h1 id="title">تحويل العملات</h1>

    <label for="fromCurrency" id="labelFrom">من</label>
    <select id="fromCurrency">
      <option value="USD">دولار أمريكي (USD)</option>
      <option value="SAR">ريال سعودي (SAR)</option>
      <option value="YER">ريال يمني (YER)</option>
    </select>

    <label for="toCurrency" id="labelTo">إلى</label>
    <select id="toCurrency">
      <option value="SAR">ريال سعودي (SAR)</option>
      <option value="YER">ريال يمني (YER)</option>
      <option value="USD">دولار أمريكي (USD)</option>
    </select>

    <label for="amount" id="labelAmount">المبلغ</label>
    <input type="number" id="amount" value="100" min="0" step="any" />

    <button id="convertBtn">تحويل</button>

    <div class="result" id="result" style="display:none;"></div>

    <div class="update-time" id="updateTime"></div>

    <div class="chart-container">
      <canvas id="exchangeChart"></canvas>
    </div>
  </div>

  <script>
    const apiURL = 'https://api.exchangerate.host/latest?base=USD&symbols=SAR,YER';
    let exchangeRates = {};
    let chart;
    let lang = 'ar';

    const elements = {
      title: document.getElementById('title'),
      labelFrom: document.getElementById('labelFrom'),
      labelTo: document.getElementById('labelTo'),
      labelAmount: document.getElementById('labelAmount'),
      convertBtn: document.getElementById('convertBtn'),
      result: document.getElementById('result'),
      updateTime: document.getElementById('updateTime'),
      fromCurrency: document.getElementById('fromCurrency'),
      toCurrency: document.getElementById('toCurrency'),
      amount: document.getElementById('amount'),
      toggleLang: document.getElementById('toggleLang')
    };

    function translateUI() {
      if (lang === 'ar') {
        document.documentElement.dir = 'rtl';
        elements.title.textContent = 'تحويل العملات';
        elements.labelFrom.textContent = 'من';
        elements.labelTo.textContent = 'إلى';
        elements.labelAmount.textContent = 'المبلغ';
        elements.convertBtn.textContent = 'تحويل';
        elements.toggleLang.textContent = 'English';

        // Update options text
        elements.fromCurrency.options[0].text = 'دولار أمريكي (USD)';
        elements.fromCurrency.options[1].text = 'ريال سعودي (SAR)';
        elements.fromCurrency.options[2].text = 'ريال يمني (YER)';

        elements.toCurrency.options[0].text = 'ريال سعودي (SAR)';
        elements.toCurrency.options[1].text = 'ريال يمني (YER)';
        elements.toCurrency.options[2].text = 'دولار أمريكي (USD)';
      } else {
        document.documentElement.dir = 'ltr';
        elements.title.textContent = 'Currency Converter';
        elements.labelFrom.textContent = 'From';
        elements.labelTo.textContent = 'To';
        elements.labelAmount.textContent = 'Amount';
        elements.convertBtn.textContent = 'Convert';
        elements.toggleLang.textContent = 'العربية';

        elements.fromCurrency.options[0].text = 'US Dollar (USD)';
        elements.fromCurrency.options[1].text = 'Saudi Riyal (SAR)';
        elements.fromCurrency.options[2].text = 'Yemeni Rial (YER)';

        elements.toCurrency.options[0].text = 'Saudi Riyal (SAR)';
        elements.toCurrency.options[1].text = 'Yemeni Rial (YER)';
        elements.toCurrency.options[2].text = 'US Dollar (USD)';
      }
    }

    async function fetchExchangeRates() {
      try {
        const response = await fetch(apiURL);
        const data = await response.json();
        if (data && data.rates) {
          exchangeRates = data.rates;
          exchangeRates['USD'] = 1; // because base is USD

          const now = new Date();
          elements.updateTime.textContent = 
            (lang === 'ar' ? 'آخر تحديث: ' : 'Last updated: ') + now.toLocaleString();

          updateChart(now, exchangeRates);
        }
      } catch (error) {
        console.error('Error fetching exchange rates:', error);
      }
    }

    function convertCurrency(amount, from, to) {
      if (!exchangeRates[from] || !exchangeRates[to]) return null;
      // convert from base (USD)
      const amountInUSD = amount / exchangeRates[from];
      const converted = amountInUSD * exchangeRates[to];
      return converted;
    }

    elements.convertBtn.addEventListener('click', () => {
      const amount = parseFloat(elements.amount.value);
      const from = elements.fromCurrency.value;
      const to = elements.toCurrency.value;

      if (isNaN(amount) || amount <= 0) {
        elements.result.style.display = 'block';
        elements.result.textContent = lang === 'ar' ? 'الرجاء إدخال مبلغ صالح' : 'Please enter a valid amount';
        return;
      }
      if (from === to) {
        elements.result.style.display = 'block';
        elements.result.textContent = lang === 'ar' ? 'يرجى اختيار عملات مختلفة' : 'Please select different currencies';
        return;
      }

      const result = convertCurrency(amount, from, to);
      if (result !== null) {
        elements.result.style.display = 'block';
        elements.result.textContent = lang === 'ar' 
          ? `${amount.toFixed(2)} ${from} = ${result.toFixed(2)} ${to}`
          : `${amount.toFixed(2)} ${from} = ${result.toFixed(2)} ${to}`;
      }
    });

    // Chart related
    const ctx = document.getElementById('exchangeChart').getContext('2d');
    let historyData = [];

    function updateChart(date, rates) {
      // We will chart USD to SAR and USD to YER for simplicity
      const usdToSar = rates['SAR'];
      const usdToYer = rates['YER'];
      historyData.push({
        time: date,
        sar: usdToSar,
        yer: usdToYer
      });

      // Keep only last 20 data points
      if (historyData.length > 20) historyData.shift();

      const labels = historyData.map(d => d.time.toLocaleTimeString());
      const sarData = historyData.map(d => d.sar);
      const yerData = historyData.map(d => d.yer);

      if (!chart) {
        chart = new Chart(ctx, {
          type: 'line',
          data: {
            labels: labels,
            datasets: [
              {
                label: lang === 'ar' ? 'الدولار مقابل الريال السعودي' : 'USD to SAR',
                data: sarData,
                borderColor: 'rgba(90, 112, 255, 1)',
                backgroundColor: 'rgba(90, 112, 255, 0.2)',
                tension: 0.3,
                fill: true,
                pointRadius: 3,
              },
              {
                label: lang === 'ar' ? 'الدولار مقابل الريال اليمني' : 'USD to YER',
                data: yerData,
                borderColor: 'rgba(255, 99, 132, 1)',
                backgroundColor: 'rgba(255, 99, 132, 0.2)',
                tension: 0.3,
                fill: true,
                pointRadius: 3,
              }
            ]
          },
          options: {
            responsive: true,
            interaction: {
              mode: 'index',
              intersect: false,
            },
            plugins: {
              legend: {
                labels: {
                  font: { size: 14 }
                }
              },
              tooltip: {
                callbacks: {
                  label: context => {
                    return `${context.dataset.label}: ${context.parsed.y.toFixed(4)}`;
                  }
                }
              }
            },
            scales: {
              x: {
                title: {
                  display: true,
                  text: lang === 'ar' ? 'الوقت' : 'Time',
                  font: { size: 14 }
                }
              },
              y: {
                title: {
                  display: true,
                  text: lang === 'ar' ? 'سعر الصرف' : 'Exchange Rate',
                  font: { size: 14 }
                },
                beginAtZero: false
              }
            }
          }
        });
      } else {
        chart.data.labels = labels;
        chart.data.datasets[0].data = sarData;
        chart.data.datasets[1].data = yerData;
        chart.update();
      }
    }

    elements.toggleLang.addEventListener('click', () => {
      lang = lang === 'ar' ? 'en' : 'ar';
      translateUI();
      if (chart) {
        chart.destroy();
        chart = null;
      }
      // Re-fetch and redraw chart to update labels language
      fetchExchangeRates();
    });

    // Initial load
    translateUI();
    fetchExchangeRates();

    // Update rates every 60 seconds
    setInterval(fetchExchangeRates, 60000);

  </script>

</body>
</html>
